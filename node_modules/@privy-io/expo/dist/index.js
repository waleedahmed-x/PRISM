"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { newObj[key] = obj[key]; } } } newObj.default = obj; return newObj; } } function _createStarExport(obj) { Object.keys(obj) .filter((key) => key !== "default" && key !== "__esModule") .forEach((key) => { if (exports.hasOwnProperty(key)) { return; } Object.defineProperty(exports, key, {enumerable: true, configurable: true, get: () => obj[key]}); }); }var _chunkOFYWAU3Ajs = require('./chunk-OFYWAU3A.js');var _jssdkcore = require('@privy-io/js-sdk-core'); _createStarExport(_jssdkcore);var _react = require('react');var Be=e=>{let{user:c,client:m,setSiweState:o,siweState:s}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),l=_react.useCallback.call(void 0, u=>{var a;let h=_chunkOFYWAU3Ajs.d.call(void 0, u);return o({status:"error",error:h}),(a=e==null?void 0:e.onError)==null||a.call(e,h),h},[e==null?void 0:e.onError]),r=_react.useCallback.call(void 0, d=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[d],function*({wallet:u,from:{domain:h,uri:a}}){var t;try{o({status:"generating-message"});let i=yield m.auth.siwe.init(u,h,a);return o({status:"awaiting-signature"}),(t=e==null?void 0:e.onGenerateMessage)==null||t.call(e,i.message),i.message}catch(i){throw l(i)}}),[m,l,e==null?void 0:e.onGenerateMessage]),n=_react.useCallback.call(void 0, a=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[a],function*({signature:u,messageOverride:h}){var d;try{if(!c)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_link_siwe_before_logged_in",error:"Must be logged in to link a wallet, Use `useLoginWithSiwe` to login with a wallet"});o({status:"submitting-signature"});let t=yield m.auth.siwe.linkWithSiwe(u,void 0,h);return o({status:"done"}),(d=e==null?void 0:e.onSuccess)==null||d.call(e,t),t}catch(t){throw l(t)}}),[c,m,l,e==null?void 0:e.onSuccess]);return{generateSiweMessage:r,linkWithSiwe:n,state:s}};var $e=e=>{let{user:c,client:m,setSiweState:o,siweState:s}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),l=_react.useCallback.call(void 0, u=>{var a;let h=_chunkOFYWAU3Ajs.d.call(void 0, u);return o({status:"error",error:h}),(a=e==null?void 0:e.onError)==null||a.call(e,h),h},[e==null?void 0:e.onError]),r=_react.useCallback.call(void 0, d=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[d],function*({wallet:u,from:{domain:h,uri:a}}){var t;try{o({status:"generating-message"});let i=yield m.auth.siwe.init(u,h,a);return o({status:"awaiting-signature"}),(t=e==null?void 0:e.onGenerateMessage)==null||t.call(e,i.message),i.message}catch(i){throw l(i)}}),[m,l,e==null?void 0:e.onGenerateMessage]);return{loginWithSiwe:_react.useCallback.call(void 0, d=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[d],function*({signature:u,messageOverride:h,disableSignup:a}){var t;try{if(c)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_login_with_siwe_while_already_logged_in",error:"Already logged in, use `useLinkWithSiwe` if you are trying to link a wallet to an existing account"});o({status:"submitting-signature"});let i=yield m.auth.siwe.loginWithSiwe(u,void 0,h,a?"no-signup":"login-or-sign-up");return o({status:"done"}),(t=e==null?void 0:e.onSuccess)==null||t.call(e,i.user,i.is_new_user),i.user}catch(i){throw l(i)}}),[c,m,l,e==null?void 0:e.onSuccess]),generateSiweMessage:r,state:s}};var or=e=>{let{user:c,client:m}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),o=_react.useCallback.call(void 0, l=>{var n;let r=_chunkOFYWAU3Ajs.d.call(void 0, l);return(n=e==null?void 0:e.onError)==null||n.call(e,r),r},[e==null?void 0:e.onError]);return{unlinkWallet:_react.useCallback.call(void 0, r=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[r],function*({address:l}){var n;try{if(!c)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_unlink_siwe_before_logged_in",error:"Must be logged in to unlink a wallet, Use `useLoginWithSiwe` to login with a wallet"});let u=yield m.auth.siwe.unlinkWallet(l);return(n=e==null?void 0:e.onSuccess)==null||n.call(e,u),u}catch(u){throw o(u)}}),[c,m,o,e==null?void 0:e.onSuccess])}};var gr=e=>{let[c,m]=_react.useState.call(void 0, ""),{user:o,client:s,otpState:l,setOtpState:r}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),n=_react.useCallback.call(void 0, a=>{var t;let d=_chunkOFYWAU3Ajs.d.call(void 0, a);return r({status:"error",error:d}),(t=e==null?void 0:e.onError)==null||t.call(e,d),d},[e==null?void 0:e.onError]),u=_react.useCallback.call(void 0, d=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[d],function*({email:a}){var t;m(a);try{r({status:"sending-code"});let i=yield s.auth.email.sendCode(a);return r({status:"awaiting-code-input"}),(t=e==null?void 0:e.onSendCodeSuccess)==null||t.call(e,{email:a}),i}catch(i){return n(i),{success:!1}}}),[s,n,e==null?void 0:e.onSendCodeSuccess]),h=_react.useCallback.call(void 0, t=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[t],function*({code:a,email:d}){var i;try{if(!o)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_link_email_before_logged_in",error:"Must be logged in to link an email, Use `useLoginWithEmail` to login with email"});let f=d||c;if(!f)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_submit_otp_before_sending",error:"Must `sendCode` with a valid email before calling `linkWithCode`"});r({status:"submitting-code"});let y=yield s.auth.email.linkWithCode(f,a);return r({status:"done"}),(i=e==null?void 0:e.onLinkSuccess)==null||i.call(e,y),y}catch(f){n(f)}}),[o,s,c,n,e==null?void 0:e.onLinkSuccess]);return{sendCode:u,linkWithCode:h,state:l}};var Wr=e=>{let[c,m]=_react.useState.call(void 0, ""),{user:o,client:s,otpState:l,setOtpState:r}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),n=_react.useCallback.call(void 0, a=>{var t;let d=_chunkOFYWAU3Ajs.d.call(void 0, a);return r({status:"error",error:d}),(t=e==null?void 0:e.onError)==null||t.call(e,d),d},[e==null?void 0:e.onError]),u=_react.useCallback.call(void 0, d=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[d],function*({email:a}){var t;m(a);try{r({status:"sending-code"});let i=yield s.auth.email.sendCode(a);return r({status:"awaiting-code-input"}),(t=e==null?void 0:e.onSendCodeSuccess)==null||t.call(e,{email:a}),i}catch(i){return n(i),{success:!1}}}),[s,n,e==null?void 0:e.onSendCodeSuccess]),h=_react.useCallback.call(void 0, i=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[i],function*({code:a,email:d,disableSignup:t}){var f;try{if(o)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_login_with_email_while_already_logged_in",error:"Already logged in, use `useLinkWithEmail` if you are trying to link an email to an existing account"});let y=d||c;if(!y)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_submit_otp_before_sending",error:"Must `sendCode` with a valid email before calling `loginWithCode`"});r({status:"submitting-code"});let w=yield s.auth.email.loginWithCode(y,a,t?"no-signup":"login-or-sign-up");return r({status:"done"}),(f=e==null?void 0:e.onLoginSuccess)==null||f.call(e,w.user,w.is_new_user),w==null?void 0:w.user}catch(y){n(y)}}),[o,s,c,n,e==null?void 0:e.onLoginSuccess]);return{sendCode:u,loginWithCode:h,state:l}};var xr=e=>{let[c,m]=_react.useState.call(void 0, ""),{user:o,client:s,otpState:l,setOtpState:r}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),n=_react.useCallback.call(void 0, a=>{var t;let d=_chunkOFYWAU3Ajs.d.call(void 0, a);return r({status:"error",error:d}),(t=e==null?void 0:e.onError)==null||t.call(e,d),d},[e==null?void 0:e.onError]),u=_react.useCallback.call(void 0, d=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[d],function*({phone:a}){var t;m(a);try{r({status:"sending-code"});let i=yield s.auth.phone.sendCode(a);return r({status:"awaiting-code-input"}),(t=e==null?void 0:e.onSendCodeSuccess)==null||t.call(e,{phone:a}),i}catch(i){return n(i),{success:!1}}}),[s,n,e==null?void 0:e.onSendCodeSuccess]),h=_react.useCallback.call(void 0, t=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[t],function*({code:a,phone:d}){var i;try{if(!o)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_link_sms_before_logged_in",error:"Must be logged in to link a phone number, Use `useLoginWithSMS` to login with a phone number"});if(!(d||c))throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_submit_otp_before_sending",error:"Must `sendCode` with a valid phone number before calling `linkWithCode`"});r({status:"submitting-code"});let y=yield s.auth.phone.linkWithCode(d||c,a);return r({status:"done"}),(i=e==null?void 0:e.onLinkSuccess)==null||i.call(e,y),y}catch(f){n(f)}}),[o,s,c,n,e==null?void 0:e.onLinkSuccess]);return{sendCode:u,linkWithCode:h,state:l}};var Rr=e=>{let[c,m]=_react.useState.call(void 0, ""),{user:o,client:s,otpState:l,setOtpState:r}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),n=_react.useCallback.call(void 0, a=>{var t;let d=_chunkOFYWAU3Ajs.d.call(void 0, a);return r({status:"error",error:d}),(t=e==null?void 0:e.onError)==null||t.call(e,d),d},[e==null?void 0:e.onError]),u=_react.useCallback.call(void 0, d=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[d],function*({phone:a}){var t;m(a);try{r({status:"sending-code"});let i=yield s.auth.phone.sendCode(a);return r({status:"awaiting-code-input"}),(t=e==null?void 0:e.onSendCodeSuccess)==null||t.call(e,{phone:a}),i}catch(i){return n(i),{success:!1}}}),[s,n,e==null?void 0:e.onSendCodeSuccess]),h=_react.useCallback.call(void 0, i=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[i],function*({code:a,phone:d,disableSignup:t}){var f;try{if(o)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_login_with_sms_while_already_logged_in",error:"Already logged in, use `useLinkWithSMS` if you are trying to link a phone number to an existing account"});if(!(d||c))throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_submit_otp_before_sending",error:"Must `sendCode` with a valid phone number before calling `loginWithCode`"});r({status:"submitting-code"});let w=yield s.auth.phone.loginWithCode(d||c,a,t?"no-signup":"login-or-sign-up");return r({status:"done"}),(f=e==null?void 0:e.onLoginSuccess)==null||f.call(e,w.user,w.is_new_user),w==null?void 0:w.user}catch(y){n(y)}}),[o,s,c,n,e==null?void 0:e.onLoginSuccess]);return{sendCode:u,loginWithCode:h,state:l}};var _expolinking = require('expo-linking'); var F = _interopRequireWildcard(_expolinking); var P = _interopRequireWildcard(_expolinking);var Dr=e=>{let{appState:c,getCurrentAppState:m}=_chunkOFYWAU3Ajs.f.call(void 0, ),{client:o,user:s,farcasterState:l,setFarcasterState:r}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),n=_react.useRef.call(void 0, !1),u=_react.useCallback.call(void 0, d=>{var i;let t=_chunkOFYWAU3Ajs.d.call(void 0, d);return r({status:"error",error:t}),(i=e==null?void 0:e.onError)==null||i.call(e,t),t},[e==null?void 0:e.onError,r]),h=_react.useCallback.call(void 0, ()=>{n.current=!0},[]);return{linkWithFarcaster:_react.useCallback.call(void 0, (f,...y)=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[f,...y],function*({relyingParty:d,redirectUrl:t},i={pollAttempts:10,pollIntervalMs:1e3}){var w;try{if(n.current=!1,!s)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_link_farcaster_before_logged_in",error:"Must be logged in to link a Farcaster account."});r({status:"generating-uri"});let{connect_uri:E,channel_token:W}=yield o.auth.farcaster.initializeAuth({relyingParty:d,redirectUrl:F.createURL(t!=null?t:"/")});if(!E)throw new (0, _jssdkcore.PrivyClientError)({code:"failed_to_generate_farcaster_uri",error:"Failed to generate farcaster uri"});if(!W)throw new (0, _jssdkcore.PrivyClientError)({code:"failed_to_generate_farcaster_channel_token",error:"Failed to generate farcaster channel token"});yield F.openURL(E),r({status:"polling-status"});let C=0;for(;C<i.pollAttempts;){if(n.current)throw new (0, _jssdkcore.PrivyClientError)({code:"farcaster_polling_canceled",error:"Farcaster polling canceled"});if(c.current!=="active"&&m()!=="active"){yield _chunkOFYWAU3Ajs.e.call(void 0, i.pollIntervalMs);continue}let b=yield o.auth.farcaster.getFarcasterStatus({channel_token:W});if(b.state==="completed"){r({status:"submitting-token"});let v=yield o.auth.farcaster.link(_chunkOFYWAU3Ajs.a.call(void 0, {channel_token:W},b));return r({status:"done"}),(w=e==null?void 0:e.onSuccess)==null||w.call(e,v),v}C++,yield _chunkOFYWAU3Ajs.e.call(void 0, i.pollIntervalMs)}throw new (0, _jssdkcore.PrivyClientError)({code:"farcaster_polling_timeout",error:"Farcasting polling timed out"})}catch(E){throw u(E)}}),[o,e==null?void 0:e.onSuccess,u,r,s]),state:l,cancel:h}};var Jr=e=>{let{client:c}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),m=_react.useCallback.call(void 0, s=>{var r;let l=_chunkOFYWAU3Ajs.d.call(void 0, s);return(r=e==null?void 0:e.onError)==null||r.call(e,l),l},[e==null?void 0:e.onError]);return{unlinkFarcaster:_react.useCallback.call(void 0, l=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[l],function*({fid:s}){var r;try{let n=yield c.auth.farcaster.unlink({fid:s});return(r=e==null?void 0:e.onSuccess)==null||r.call(e,n),n}catch(n){throw m(n)}}),[c,e==null?void 0:e.onSuccess,m])}};var et=e=>{let{appState:c,getCurrentAppState:m}=_chunkOFYWAU3Ajs.f.call(void 0, ),{client:o,user:s,farcasterState:l,setFarcasterState:r}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),n=_react.useRef.call(void 0, !1),u=_react.useCallback.call(void 0, d=>{var i;let t=_chunkOFYWAU3Ajs.d.call(void 0, d);return r({status:"error",error:t}),(i=e==null?void 0:e.onError)==null||i.call(e,t),t},[e==null?void 0:e.onError,r]),h=_react.useCallback.call(void 0, ()=>{n.current=!0},[]);return{loginWithFarcaster:_react.useCallback.call(void 0, (y,...w)=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[y,...w],function*({relyingParty:d,redirectUrl:t,disableSignup:i},f={pollAttempts:10,pollIntervalMs:1e3}){var E;try{if(n.current=!1,s)throw new (0, _jssdkcore.PrivyClientError)({code:"attempted_login_with_farcaster_while_already_logged_in",error:"Already logged in, use `useLinkWithFarcaster` if you are trying to link farcaster to an existing account"});r({status:"generating-uri"});let{connect_uri:W,channel_token:C}=yield o.auth.farcaster.initializeAuth({relyingParty:d,redirectUrl:P.createURL(t!=null?t:"/")});if(!W)throw new (0, _jssdkcore.PrivyClientError)({code:"failed_to_generate_farcaster_uri",error:"Failed to generate farcaster uri"});if(!C)throw new (0, _jssdkcore.PrivyClientError)({code:"failed_to_generate_farcaster_channel_token",error:"Failed to generate farcaster channel token"});yield P.openURL(W),r({status:"polling-status"});let b=0;for(;b<f.pollAttempts;){if(n.current)throw new (0, _jssdkcore.PrivyClientError)({code:"farcaster_polling_canceled",error:"Farcaster polling canceled"});if(c.current!=="active"&&m()!=="active"){yield _chunkOFYWAU3Ajs.e.call(void 0, f.pollIntervalMs);continue}let v=yield o.auth.farcaster.getFarcasterStatus({channel_token:C});if(v.state==="completed"){r({status:"submitting-token"});let A=yield o.auth.farcaster.authenticate(_chunkOFYWAU3Ajs.a.call(void 0, {channel_token:C,mode:i?"no-signup":"login-or-sign-up"},v));return r({status:"done"}),(E=e==null?void 0:e.onSuccess)==null||E.call(e,A.user,A.is_new_user),A.user}b++,yield _chunkOFYWAU3Ajs.e.call(void 0, f.pollIntervalMs)}throw new (0, _jssdkcore.PrivyClientError)({code:"farcaster_polling_timeout",error:"Farcasting polling timed out"})}catch(W){throw u(W)}}),[o,u,e==null?void 0:e.onSuccess,r,s,c]),state:l,cancel:h}};var ot=e=>{let{client:c}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),m=_react.useCallback.call(void 0, s=>{var r;let l=_chunkOFYWAU3Ajs.d.call(void 0, s);return(r=e==null?void 0:e.onError)==null||r.call(e,l),l},[e==null?void 0:e.onError]);return{unlinkOAuth:_react.useCallback.call(void 0, r=>_chunkOFYWAU3Ajs.c.call(void 0, void 0,[r],function*({provider:s,subject:l}){var n;try{let u=yield c.auth.oauth.unlink(s,l);return(n=e==null?void 0:e.onSuccess)==null||n.call(e,u),u}catch(u){throw m(u)}}),[c,e==null?void 0:e.onSuccess,m])}};var V=(e={})=>{let{wallet:c,createWalletCallbacks:m,recoverWalletCallbacks:o,setWalletRecoveryCallbacks:s}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),{onCreateWalletSuccess:l,onCreateWalletError:r,onRecoverWalletError:n,onRecoverWalletSuccess:u,onSetWalletRecoverySuccess:h,onSetWalletRecoveryError:a}=e;return _react.useEffect.call(void 0, ()=>{m.current={onSuccess:l,onError:r}},[l,r]),_react.useEffect.call(void 0, ()=>{o.current={onSuccess:u,onError:n}},[u,n]),_react.useEffect.call(void 0, ()=>{s.current={onSuccess:h,onError:a}},[u,n]),c};var ht=({onStateChange:e})=>{let c=V();return _react.useEffect.call(void 0, ()=>{e(c)},[c])};var wt=()=>{let{getIdentityToken:e}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k);return{getIdentityToken:e}};var xe=(e={})=>{let{solanaWallet:c,createSolanaWalletCallbacks:m,recoverSolanaWalletCallbacks:o}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k),{onCreateWalletSuccess:s,onCreateWalletError:l,onRecoverWalletError:r,onRecoverWalletSuccess:n}=e;return _react.useEffect.call(void 0, ()=>{m.current={onSuccess:s,onError:l}},[s,l]),_react.useEffect.call(void 0, ()=>{o.current={onSuccess:n,onError:r}},[n,r]),c};var Ue=()=>{let{client:e}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k);return e};var Pe=()=>{let{user:e,isReady:c,logout:m,getAccessToken:o}=_react.useContext.call(void 0, _chunkOFYWAU3Ajs.k);return{user:e,isReady:c,logout:m,getAccessToken:o}};exports.PrivyContext = _chunkOFYWAU3Ajs.k; exports.PrivyProvider = _chunkOFYWAU3Ajs.m; exports.SecureStorageAdapter = _chunkOFYWAU3Ajs.j; exports.getAccessToken = _chunkOFYWAU3Ajs.l; exports.hasError = _chunkOFYWAU3Ajs.t; exports.isConnected = _chunkOFYWAU3Ajs.n; exports.isConnecting = _chunkOFYWAU3Ajs.p; exports.isCreating = _chunkOFYWAU3Ajs.s; exports.isDisconnected = _chunkOFYWAU3Ajs.q; exports.isNotCreated = _chunkOFYWAU3Ajs.r; exports.isReconnecting = _chunkOFYWAU3Ajs.o; exports.needsRecovery = _chunkOFYWAU3Ajs.u; exports.useEmbeddedSolanaWallet = xe; exports.useEmbeddedWallet = V; exports.useEmbeddedWalletStateChange = ht; exports.useIdentityToken = wt; exports.useLinkEmail = gr; exports.useLinkSMS = xr; exports.useLinkWithFarcaster = Dr; exports.useLinkWithOAuth = _chunkOFYWAU3Ajs.h; exports.useLinkWithSiwe = Be; exports.useLoginWithEmail = Wr; exports.useLoginWithFarcaster = et; exports.useLoginWithOAuth = _chunkOFYWAU3Ajs.g; exports.useLoginWithSMS = Rr; exports.useLoginWithSiwe = $e; exports.useOAuthFlow = _chunkOFYWAU3Ajs.i; exports.usePrivy = Pe; exports.usePrivyClient = Ue; exports.useUnlinkFarcaster = Jr; exports.useUnlinkOAuth = ot; exports.useUnlinkWallet = or;
